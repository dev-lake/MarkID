# iCloud 自动备份功能

## 功能概述

马克证件应用现已支持 iCloud 自动备份功能，可以安全地将您的证件数据、导出记录、安全配置和水印配置备份到 iCloud，确保数据安全和跨设备同步。

## 主要特性

### 🔄 自动备份
- **定时备份**: 支持自定义备份频率（6小时、12小时、24小时、48小时、72小时）
- **智能检查**: 应用启动时自动检查是否需要备份
- **网络优化**: 可选择仅在 WiFi 环境下进行备份，节省移动数据

### 📱 手动备份
- **即时备份**: 随时手动触发备份操作
- **备份历史**: 查看所有备份记录和状态
- **备份恢复**: 从任意备份点恢复数据

### 🔒 安全保护
- **选择性备份**: 可选择备份内容（证件数据、导出记录、配置等）
- **加密保护**: 备份数据采用加密存储
- **密钥管理**: 可选择是否备份加密密钥（默认关闭）

### 📊 备份管理
- **备份统计**: 查看备份成功率、总大小等统计信息
- **记录管理**: 查看、删除备份记录
- **自动清理**: 自动清理过期备份记录

## 使用方法

### 1. 访问备份设置
在应用主界面点击右上角的备份图标（☁️），进入备份设置页面。

### 2. 配置自动备份
- **启用自动备份**: 打开"启用自动备份"开关
- **设置备份频率**: 选择备份间隔时间
- **网络限制**: 可选择仅在 WiFi 下备份
- **备份内容**: 选择需要备份的数据类型

### 3. 执行手动备份
点击"立即备份"按钮执行手动备份操作。

### 4. 查看备份历史
点击"备份历史"查看所有备份记录，包括：
- 备份时间
- 备份类型（自动/手动）
- 备份状态（成功/失败）
- 备份大小
- 备份耗时

### 5. 恢复备份
在备份历史中选择任意备份记录，点击"恢复"按钮即可从该备份点恢复数据。

## 备份内容说明

### 证件数据
- 所有证件照片的基本信息
- 证件类型、号码、持有人姓名
- 标签和备注信息
- 拍摄时间和创建时间

### 导出记录
- 所有导出操作的历史记录
- 导出文件信息
- 应用的水印配置
- 导出时间和设备信息

### 安全配置
- 生物识别设置
- PIN码配置
- 自动锁定设置
- 加密算法配置

### 水印配置
- 显性水印设置
- 暗水印设置
- 水印位置和样式
- 水印内容模板

## 安全注意事项

### 数据加密
- 所有备份数据在传输和存储过程中都经过加密
- 使用 AES-256 加密算法保护敏感信息
- 加密密钥默认不备份，确保最高安全性

### 隐私保护
- 备份数据仅存储在您的 iCloud 账户中
- 应用无法访问其他用户的备份数据
- 备份操作需要用户明确授权

### 网络安全
- 支持仅在 WiFi 环境下备份
- 避免在公共网络环境下进行敏感操作
- 建议在安全的网络环境下进行备份

## 故障排除

### 备份失败
1. **检查网络连接**: 确保设备连接到稳定的网络
2. **检查 iCloud 空间**: 确保 iCloud 有足够的存储空间
3. **检查权限**: 确保应用有访问 iCloud 的权限
4. **查看错误信息**: 在备份历史中查看具体的错误原因

### 恢复失败
1. **检查备份完整性**: 确保备份文件没有损坏
2. **检查存储空间**: 确保设备有足够的存储空间
3. **关闭其他应用**: 关闭可能占用数据的其他应用
4. **重启应用**: 重启应用后再次尝试恢复

### 自动备份不工作
1. **检查设置**: 确保自动备份功能已启用
2. **检查频率**: 确认备份频率设置合理
3. **检查网络**: 如果设置了仅 WiFi 备份，确保连接到 WiFi
4. **检查时间**: 确认距离上次备份已超过设定时间

## 技术实现

### 架构设计
- **服务层**: `ICloudBackupService` 负责备份核心逻辑
- **提供者层**: `BackupProvider` 管理备份状态和配置
- **界面层**: `BackupSettingsScreen` 提供用户界面
- **模型层**: `BackupConfig`、`BackupRecord` 等数据模型

### 数据流程
1. **配置管理**: 用户设置备份配置，保存到本地存储
2. **数据准备**: 根据配置收集需要备份的数据
3. **文件创建**: 将数据序列化为 JSON 格式
4. **云存储**: 上传备份文件到 iCloud
5. **记录管理**: 保存备份记录和统计信息

### 安全机制
- **数据加密**: 使用 AES-256 加密敏感数据
- **密钥管理**: 安全的密钥生成和存储机制
- **权限控制**: 严格的访问权限控制
- **数据验证**: 备份数据的完整性验证

## 未来计划

### 功能增强
- [ ] 支持增量备份，减少备份时间和数据量
- [ ] 支持备份压缩，进一步节省存储空间
- [ ] 支持备份加密，提供额外的安全保护
- [ ] 支持备份同步，实现多设备数据同步

### 用户体验
- [ ] 备份进度显示，提供更好的用户反馈
- [ ] 备份通知，及时告知用户备份状态
- [ ] 备份预览，允许用户查看备份内容
- [ ] 备份比较，显示不同备份之间的差异

### 技术优化
- [ ] 优化备份性能，减少备份时间
- [ ] 改进错误处理，提供更详细的错误信息
- [ ] 增强数据验证，确保备份数据完整性
- [ ] 优化存储管理，自动清理过期备份

## 联系支持

如果您在使用备份功能时遇到任何问题，请通过以下方式联系我们：

- **应用内反馈**: 在设置页面提交反馈
- **邮件支持**: 发送邮件到 support@markid.com
- **在线文档**: 访问我们的在线帮助文档

---

*最后更新: 2024年12月* 